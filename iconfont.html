<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Как собрать иконочный шрифт из файла скетча</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">        
    <meta name="description" content="">
    
    <link rel="icon" href="/blog/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu+Mono&amp;subset=latin">
    <!-- Canonical url (https://support.google.com/webmasters/answer/139066) -->
    <link rel="canonical" href="/blog/iconfont">
    
    <!-- Main CSS File (compiled from _sass forder) -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/main.css">
</head>
    <body>
        <header class="main-header">
    <div class="wc-container">
        <h1><a href="/blog/">Positive.JS</a></h1>
        <ul>
            <li>
                <a href="/blog/about">О нас</a><span>/</span>
            </li>
            <li>
                <a href="/blog/blog">Архив</a><span>/</span>
            </li>
        </ul>               
    </div>
</header>


        <div class="page-content wc-container">
    <div class="post">
        <h1>Как собрать иконочный шрифт из файла скетча</h1>
        <p class="post-meta">
            
                <span class="categories">
                
                    CSS, fonts, и 10 мин чтения
                
                </span> |
            
            <span class="post-date">
                
                    05.04.2017 
                
            </span>
        </p>
        <div class="post">
            <p><img src="https://habrastorage.org/files/7bb/f4f/812/7bbf4f8120f9441d844daf29fcc16582.png" alt="image" /></p>

<p>У дизайнера есть несколько разных способов передать иконки разработчику:</p>

<p>— отдельными файлами PNG и спрайтом PNG,
— отдельными файлами SVG и спрайтом SVG,
— иконочным шрифтом.</p>

<p>Разработчики фронтенда все чаще привыкли использовать иконки в виде шрифта. Этим же способом распространяются популярные иконочные наборы (например, Font Awesome). У нас в компании разработчики тоже просят «дай шрифт». Мы некоторое время отлаживали схему сборки шрифта: как из файла Sketch автоматически получить файл, пригодный для фронтенда, не замучив дизайнера.</p>

<p>В этом посте я расскажу о нашей схеме, покажу скрипты сборки. Рассказ может быть полезен разработчикам фронтенда и дизайнерам интерфейсов. В меньшей степени он будет полезен бекендным разработчикам интерфейсов (классический Asp.Net MVC или что-то подобное): схема будет та же, но не будет готовых файлов конфигураций и скриптов.</p>

<cut />

<h2 id="Зачем-это-делать-есть-же-фонтелло">Зачем это делать, есть же фонтелло</h2>

<p>Есть много готовых сервисов, которые собирают шрифт по загруженным SVG-файлам, например fontello. Мы не стали использовать ни один из них, потому что с ними могут быть сложности:</p>

<p><strong>Дизайнер может случайно сломать шрифт</strong>. Если забыть и не экспортировать иконку, которую уже давал, то следующая версия шрифта будет без него и в неизвестном месте сломается интерфейс. Ситуацию усугубляет факт, что дизайнеров у каждого продукта несколько, а общий набор иконок пополняют 5-6 человек.</p>

<p>Хорошее решение — простое, в нем минимум ручных действий.</p>

<p><strong>Нескольким дизайнерам работать непросто</strong>. Если несколько дизайнеров поддерживают один шрифт, то возникает много вопросов синхронизации: где хранить исходники, файлы SVG и файлы шрифта, кто собирает и кому передает, как не забыть иконку.</p>

<p>Хорошее решение позволяет добавлять иконки скольким угодно дизайнерам так, что они не испортят чужую работу.</p>

<p><strong>Cложно интегрировать в общий процесс сборки продукта</strong>. Отдельно стоящий сервис тяжело встроить в общий процесс разработки и сборки, а у кого-то есть еще и процесс CI. Придется вручную собирать сервисом файл, куда-то его загружать и как-то версионировать.</p>

<p>Хорошее решение встраивается в процесс разработки.</p>

<p><strong>Не всех устраивает внешний сервис</strong>. Многие компании не верят во внешние сервисы: они могут изменить набор функций, упасть во время подготовки релиза, стать платными или закрыться. В конце концов, их могут хакнуть. Мы — ИБ-компания, и каждый раз раздражать профессионально деформированных безопасников и разработчиков наличием внешнего сервиса не хочется.</p>

<p>Хорошее решение работает внутри компании.</p>

<p><strong>Формируется не все, что надо</strong>. Некоторые сервисы выдают шрифт, а иконки кодируют номерами символов. К сожалению, на эти номера полагаться нельзя. Если убрать иконку или поменять порядок, то в следующий раз сервис может выдать совсем другие коды и все иконки непредсказуемо поменяются.</p>

<p>Если не формировать вместе со шрифтом less-файл, то разработчикам придется в каждом использовании иконки указывать размер кегля, они могут забыть или ошибиться.</p>

<p>Хорошее решение дает разработчикам все что нужно. Иконка кодируется понятным названием, коды символов и размер подставляются автоматически.</p>

<h2 id="Вариант-1-Собираем-и-отдаем-шрифт">Вариант 1. Собираем и отдаем шрифт</h2>

<p>Вся сборка идет на компьютере дизайнера. Установленный Sketch не обязателен, а вот без мака ничего не выйдет. Я выложил все необходимые файлы в репозиторий <a href="https://github.com/mikeozornin/icon-font-public">mikeozornin/icon-font-public</a>, скачайте его и распакуйте куда-нибудь.</p>

<p>Скачать: https://github.com/mikeozornin/icon-font-public/archive/master.zip</p>

<h3 id="Шаг-1-Настройка-среды">Шаг 1. Настройка среды</h3>
<p>Все эти заклинания надо произнести один раз, дальше они не понадобятся:</p>

<p>1) Установить brew. Brew — это такой менеджер пакетов, который легко позволяет ставить программы и библиотеки. Выполнить в терминале команду:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>/usr/bin/ruby -e <span class="s2">"</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">"</span>
</code></pre>
</div>

<p>2) С помощью brew установить шрифтообработчики:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>brew install ttfautohint fontforge --with-python
</code></pre>
</div>

<p>3) Установить node.js, скачать тут (https://nodejs.org/en/) current-версию и действовать по инструкции.</p>

<p>4) Установить SketchTool. При установленном Sketch выполнить в терминале команду:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>/Applications/Sketch.app/Contents/Resources/sketchtool/install.sh
</code></pre>
</div>

<p>5) Установить grunt. Выполнить в терминале команду:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install -g grunt-cli
</code></pre>
</div>

<h3 id="Шаг2-Сборка-файла-шрифта">Шаг 2. Сборка файла шрифта</h3>
<p>Для сборки шрифта нужно открыть терминал в корневой папке проекта и произнести заклинание:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>./build.sh
</code></pre>
</div>

<p>Если в первый раз не сработает, сделайте скрипт выполняемым:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>chmod +x build.sh
</code></pre>
</div>

<p>Описанная схема работает так:</p>

<p>— С помощью SketchTool все, что может быть экспортировано, экспортируется из скетча в SVG-файлы. Обратите внимание на то, что иконка должны быть покрыта слайсом или располагаться на отдельном артборде (артборд лучше).
— SVG-файлы, полученные на предыдущем шаге, собираются в шрифт. Для этого запускается сборщик шрифта, который все SVG-файлы собирает в шрифт, конвертирует его в нужный формат.
— Параллельно тот же сборщик формирует HTML-страницу с предварительным просмотром и less-файл для шрифта.</p>

<p>Каждый раз при сборке шрифта дизайнеру нужно:</p>

<p>1) Нарисовать иконку.
2) Собрать шрифт: ./build.sh.
3) (опционально) Закоммитить sketch-файл, шрифт и SVG-файлы в гит.
4) Отдать файл шрифта и less-файл разработчику.
5) Сказать ему название новой иконки, например: my-icons-bell_16.</p>

<h2 id="Вариант-2-Собираем-и-отдаем-шрифт-npm-пакетом">Вариант 2. Собираем и отдаем шрифт NPM-пакетом</h2>
<p>Если продуктов, дизайнеров и разработчиков много, возникают вопросы синхронизации.
Приведу пример: Я собрал для одной команды шрифт, а потом вторая захотела такие же иконки. Должен ли я дать им тот же файл, или собирать отдельно? Отправлять ли двум командам новый файл после того, как добавится иконка? Что делать, если я хочу переделать половину иконок, а часть убрать, как предупредить разработчика, чтобы он был внимателен? Что делать, если я не один, а дизайнеров много?</p>

<p>Разработчики уже умеют решать подобные проблемы. Для библиотек у них есть менеджеры пакетов и библиотек (менеджер пакетов — это не должность :-). Фронтенд-разработчики подключают библиотеки через NPM-пакеты. Для них это привычная и удобная среда, кроме этого, NPM-пакет сделает передачу шрифта удобней. NPM-репозиторий берет на себя вопросы распространения файла между разработчиками, его версионирования, одновременной поддержки двух разных версий шрифта (новой и еще поддерживаемой старой). Скорей всего, если вы предложите разработчику не передавать файл вручную, а собирать пакет, он будет только рад.</p>

<p>В этом способе больше шагов, но работать с ним проще. У нас собирается пакетом.</p>

<h3 id="Шаг-1-Донастройка-среды">Шаг 1. Донастройка среды</h3>
<p>Нужно настроить среду — как в первом варианте — и дополнительно настроить локальный NPM-репозиторий. Что это такое и как настроить, спросите вашего фронтендера: настройка зависит от принятых в команде соглашений. Кроме этого, попросите его исправить файл package.json из комплекта.</p>

<h3 id="Шаг-2-Сборка-файла-шрифта">Шаг 2. Сборка файла шрифта</h3>
<p>Каждый раз при сборке шрифта дизайнеру нужно сделать следующее (<em>курсивом</em> выделены новые действия):</p>

<p>1) Нарисовать иконку.
2) Собрать шрифт: ./build.sh.
3) Закоммитить sketch-файл, шрифт и SVG-файлы в гит.
4) <em>Изменить версию пакета в файле package.json, дописать изменения в changelog.</em>
5) <em>Закоммитить файлы package.json и changelog.</em>
6) <em>Выполнить команду grunt publish.</em>
7) Передать разработчику шифровку «Выпустил пакет версии xxx».
8) Сказать ему название новой иконки, например: my-icons-bell_16.</p>

<p>Договоритесь с разработчиками, как именовать версии, если они предложат «семвер» — соглашайтесь. Мы с коллегами инкрементируем минор (1.1.1 → 1.1.2), если обратная совместимость шрифта не теряется, — можно смело обновлять шрифт в продукте. Если теряется, то изменяем мажорный (1.1.1 → 1.2.0), — нужно изучить изменения и что-то поправить в коде продукта.</p>

<h2 id="Вариант-3-Собираем-и-отдаем-шрифт-nuget-пакетом">Вариант 3. Собираем и отдаем шрифт Nuget-пакетом</h2>
<p>Весь наш интерфейс работает полностью на фронтенде (написан на Angular). Бекенд-разработчики используют Nuget и никак не используют иконки. Поэтому у меня нет опыта сборки Nuget-пакетов.</p>

<p>Но если кто-то соберет рабочий вариант со скриптами и конфигами, то с удовольствием допишу в пост.</p>

<h2 id="На-что-обратить-внимание-при-рисовании-иконок">На что обратить внимание при рисовании иконок</h2>
<p>Иногда иконка, которая выглядит хорошо в Sketch, портится до неузнаваемости в шрифте. Чтобы такого не происходило, перед экспортом иконок не забудьте перевести все в кривые. Проверьте, что в иконке не осталось:</p>

<p>— радиусов скруглений,
— бордеров (можно использовать только заливки),
— текстовых надписей (должны быть переведены в кривые).</p>

<p>После экспорта проверяйте иконку в демо-HTML-файле. Иногда бывает, что SVG показывается хорошо, а в HTML — нет.</p>

<h2 id="Если-что-то-не-работает">Если что-то не работает</h2>
<p>Я не делал пример из поста с нуля, а взял наше рабочее решение и немного его обрезал, чтобы можно было выложить его в паблик. Работоспособность проверял, но мало ли что, может что-то и переобрезал. Пишите, если что-то не работает, или попросите помочь вашего фронтендера, он разберется.</p>

<p>Пишите, если есть вопросы или пожелания.</p>

        </div>
    </div>

    
    <div class="related">
        <h4>Похожие статьи</h4>
        <ul class="posts">
            
            <li>
                <span>
                
                    03.09.2017 
                 &raquo;</span>
                <a href="/blog/css-font-metrics-line-height-and-vertical-align">Deep dive CSS: font metrics, line-height and vertical-align</a>
            </li>
            
            <li>
                <span>
                
                    30.01.2017 
                 &raquo;</span>
                <a href="/blog/rxjs/reactive">RxJS - Часть 1, Введение в реактивное программирование</a>
            </li>
            
        </ul>
    </div>
    

    <div class="post-footer">
        <div class="column-1">
            
                <a href="/blog/rxjs/reactive"><< Предыдущая статья</a>
            
        </div>
        <div class="column-2"><a href="/blog/ ">Домашняя страница</a></div>
        <div class="column-3">
            
                <a href="/blog/css-font-metrics-line-height-and-vertical-align">Следующая статья >></a>
            
        </div>
    </div>
</div>

        <footer class="main-footer">
    <div class="wc-container">  
        <div class="column one">
            <h6>Ссылки</h6>
            <ul class="menu">
                <li><a href="/blog/about">О нас</a></li>
                <li><a href="/blog/blog">Архив</a></li>
                <li><a href="https://ptsecurity.com">PTSecurity</a></li>
            </ul>                    
        </div>
        <div class="column two">
            <h6>Социальные сети</h6>

<ul class="social-media">

    
    <li>
        <a title="ptsecurity on Twitter" 
            href="https://twitter.com/ptsecurity" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="positive-js on Github" 
            href="https://github.com/positive-js" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    <li>
        <a title="positivejs on Telegram" 
            href="https://t.me/positivejs" 
            class="telegram wc-img-replace" target="_blank">Telegram</a>
    </li>
</ul>

        </div>
    </div>
    <p class="wc-container disclaimer">
        Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
    </p>
</footer>

        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92531585-1', 'auto');
    ga('send', 'pageview');
</script>
    </body>
</html>
